# 9. 운영체제 시작하기
- [9. 운영체제 시작하기](#9-운영체제-시작하기)
  - [9-1. 운영체제를 알아야 하는 이유](#9-1-운영체제를-알아야-하는-이유)
    - [1) 운영체제란?](#1-운영체제란)
      - [운영체제 작동 방식](#운영체제-작동-방식)
    - [2) 운영체제를 알아야 하는 이유](#2-운영체제를-알아야-하는-이유)
  - [9-2. 운영체제의 큰 그림](#9-2-운영체제의-큰-그림)
    - [1) 운영체제의 심장, 커널](#1-운영체제의-심장-커널)
    - [2) 이중 모드와 시스템 호출](#2-이중-모드와-시스템-호출)
      - [이중 모드](#이중-모드)
      - [사용자 모드](#사용자-모드)
      - [커널 모드](#커널-모드)
      - [시스템 호출](#시스템-호출)
    - [2) 운영체제의 핵심 서비스](#2-운영체제의-핵심-서비스)
      - [프로세스 관리](#프로세스-관리)
      - [자원 접근 및 할당](#자원-접근-및-할당)
      - [파일 시스템 관리](#파일-시스템-관리)
  - [9-3. 추가](#9-3-추가)
    - [1) 가상 머신](#1-가상-머신)
    - [2) 시스템 호출의 종류](#2-시스템-호출의-종류)
  - [Q\&A](#qa)
    - [Q1. 운영체제와 커널에 대해 설명하고 커널에 해당되지 않는 운영체제는 무엇인지 설명하세요.](#q1-운영체제와-커널에-대해-설명하고-커널에-해당되지-않는-운영체제는-무엇인지-설명하세요)
    - [Q2. 이중 모드가 무엇인가요?](#q2-이중-모드가-무엇인가요)
    - [Q3. 시스템 호출이 무엇인가요?](#q3-시스템-호출이-무엇인가요)

## 9-1. 운영체제를 알아야 하는 이유
- 컴퓨터 부품들은 운영체제라는 특별한 프로그램의 지취하에 작동
### 1) 운영체제란?
- 시스템 자원(자원) : 프로그램 실행에 마땅히 필요한 요소들
  - CPU, 메모리, 보조기억장치, 입출력 장치 등 컴퓨터 부품들을 모두 자원이라고 볼 수 있음
- **운영체제 : 실행할 프로그램에 필요한 자원을 할당하고 프로그램이 올바르게 실행되도록 돕는 특별한 프로그램**

- 운영체제는 인터넷 브라우저, 게임과 같은 프로그램
- 여느 프로그램처럼 메모리에 적재됨
- 대신 특별한 프로그램이기 때문에 항상 컴퓨터가 부팅될 때 메모리 내 ***커널 영역***이라는 공간에 따로 적재
  - 사용자 영역 : 커널 영역을 제외한 나머지 영역, 즉 사용자가 이용하는 응용 프로그램이 적재되는 영역
- ***운영체제는 커널 영역에 적재되어 사용자 영역에 적재된 프로그램들에 자원을 할당하고 이들이 올바르게 실행되도록 도움***  
![!\[alt text\](image.png)](<커널영역 운영체제.png>)

#### 운영체제 작동 방식
- 운영체제를 통해 응용 프로그램들이 적재적소의 메모리에 적재됨
![!\[alt text\](image.png)](<운영체제 작동방식.png>)

- 어떤 프로그램부터 CPU를 사용하게 할지, 얼마나 오랫동안 CPU를 이용하게 할지도 운영체제가 해결 => 운영체제는 최대한 공정하게 여러 프로그램에 CPU 자원을 할당함
  ![!\[alt text\](image.png)](<운영체제-CPU 관리.png>)
  - 동시에 동일한 프린터를 이용하려고 할 때 한 프로그램은 기다리게 하여 프린터 자원을 관리함
  ![!\[alt text\](image.png)](<운영체제-자원 관리.png>)

- 운영체제의 프로그램 자원 관리 방식
  - ![!\[alt text\](image.png)](<운영체제-자원 접근 및 관리.png>)
  - 운영체제는 흔히 정부에 비유됨
    - 정부는 땅, 인력, 돈 등 국내 자원을 효율적으로 배분하고 국민들이 지켜야 할 규칙을 만들어 나라를 관리함
  - 운영체제도 자원을 효율적으로 배분, 실행해야할 프로그램들이 지켜야 할 규칙을 만들어 컴퓨터 시스템 전체를 관리
    - 운영체제 또한 관리할 자원별로 기능이 나누어져있음
  ![!\[alt text\](image.png)](운영체제VS국가.png)

### 2) 운영체제를 알아야 하는 이유
- 운영체제를 통해 현재 하드웨어 상태, 코드가 어떻게 실행되는지, 하드웨어 상에 어떤 문제가 있는지 등을 상세히 알 수 있음 => 문제 해결의 실마리를 찾을 수 있음
- 대표적인 운영체제와의 대화 예시 = 오류메시지
![!\[alt text\](image.png)](<운영체제 오류메시지.png>)
![alt text](image.png)

## 9-2. 운영체제의 큰 그림
### 1) 운영체제의 심장, 커널
- 운영체제는 현존하는 프로그램 중 규모가 가장 큰 프로그램 중 하나
- 다양한 운영체제가 있으며 응용 프로그램에 제공하는 기능들(운영체제의 서비스)도 다양함
- 핵심 서비스 : 자원에 접근하고 조작하는 기능, 프로그램이 올바르고 안전하게 실행되게 하는 기능
- 커널 : 자원에 접근하고 조작하는 기능, 프로그램이 올바르고 안전하게 실행되게 하는 ***핵심 서비스***를 담당하는 부분

<br>

- 운영체제가 설치된 모든 기기에는 커널이 있음
- 어떤 커널을 사용하는지에 따라 실행하고 개발하는 프로그램이 하드웨어를 이용하는 양상이 달라지고 컴퓨터의 성능도 달라짐
- 운영체제를 지칭할 때 대체로 커널을 지칭한다고 봐도 무방함
![!\[alt text\](image.png)](<커널의 형태.png>)

<br>

- 사용자 인터페이스 : 운영체제가 제공하는 서비스 중 커널에 포함되지 않는 서비스
  - 윈도우의 바탕화면과 같이 사용자가 컴퓨터와 상호작용할 수 있는 통로
  - 종류 
    - 그래픽 유저 인터페이스 : 그래픽 기반으로 컴퓨터와 상호작용할 수 있는 인터페이스
    - 커맨드 라인 인터페이스 : 명령어 기반으로 컴퓨터와 상호작용할 수 있는 인터페이스
  - 운영체제가 제공하는 서비스이지만 컴퓨터와 상호작용하기 위한 통로일 뿐 커널은 아님

### 2) 이중 모드와 시스템 호출
- 운영체제는 사용자가 실행하는 응용 프로그램이 하드웨어 자원에 직접 접근하는 것을 방지하여 자원을 보호
- 운영체제는 응용 프로그램의 자원 접근을 대행하는 일종의 문지기 역할을 하는 것
- 운영체제에 도움을 요청한다는 말 = 운영체제 코드를 실행하려고 한다
- 응용 프로그램의 요청을 받은 운영체제는 응용 프로그램 대신 자원에 접근하여 요청한 작업을 수행
- 예 : 응용 프로그램이 하드 디스크에 데이터를 저장해야한다면 운영체제에 도움을 요청하게 되고 운영체제는 커널 영역 내의 하드 디스크에 데이터를 저장하는 코드를 실행하여 대신 수행해줌
  ![!\[alt text\](image.png)](<운영체제 도움 방식.png>)

#### 이중 모드
- 운영체제의 문지기 역할은 이중 모드로써 구현
- 이중 모드 : CPU가 명령어를 실행하는 모드를 크게 사용자 모드와 커널 모드로 구분하는 방식
  - CPU는 명령어를 사용자 모드, 커널 모드로써 실행 가능

#### 사용자 모드
- 운영체제 서비스를 제공받을 수 없는 실행 모드
- 커널 영역의 코드를 실행할 수 없는 모드
- 일반적인 응용 프로그램은 기본적으로 사용자 모드로 실행됨
- 사용자 모드로 실행 중인 CPU는 입출력 명령어와 같이 하드웨어 자원에 접근하는 명령어를 실행할 수 없음
- 사용자 모드로 실행되는 일반적인 응용 프로그램은 자원에 접근 불가능

#### 커널 모드
- 커널 모드 : 운영체제 서비스를 제공받을 수 있는 실행 모드
- 커널 영역의 코드를 실행할 수 있는 모드
- CPU가 커널 모드로 명령어를 실행하면 자원에 접근하는 명령어를 비롯한 모든 명령어를 실행할 수 있음

![!\[alt text\](image.png)](<이중 모드.png>)

#### 시스템 호출
- 시스템 호출(시스템 콜) : 사용자 모드로 실행되는 프로그램이 자원에 접근하는 운영체제 서비스를 제공 받기 위해 커널 모드로 전환하는 방법
![!\[alt text\](image.png)](<시스템 호출.png>)
- 소프트웨어 인터럽트 : 시스템 호출과 같이 특정 명령어에 의해 발생하는 소프트웨어적인 인터럽트
  - 인터럽트 처리 순서와 유사
  - 순서 : 시스템 호출을 발생시키는 명령어 실행 -> CPU는 지금까지 작업 백업 -> 커널 영역 내 시스템 호출을 수행하는 코드(인터럽트 서비스 루틴)를 실행 -> 기존 응용 프로그램으로 복귀하여 실행
  ![!\[alt text\](image.png)](<시스템 호출 과정.png>)
    - 시스템 호출을 발생시켜 커널 모드로 전환 -> 운영체제 내의 하드디스크에 데이터를 저장하는 코드를 실행 -> 하드 디스크에 접근이 끝났으면 다시 사용자 모드로 복귀하여 실행
  ![!\[alt text\](image.png)](<서비스 호출 순환 과정.png>)

### 2) 운영체제의 핵심 서비스
- 프로세스 관리, 자원 접근 및 할당, 파일 시스템 관리
#### 프로세스 관리
- 프로세스 : 실행 중인 프로그램
- 일반적으로 하나의 CPU는 한번에 하나의 프로세스만 실행 가능 -> CPU가 프로세스들을 조금씩 번갈아 가며 실행
- 운영체제는 다양한 프로세스를 관리하고 실행할 수 있어야 함
- 여러 프로세스가 동시에 실행되는 환경에서 '프로세스 동기화'가 필수적
- 프로세스가 꼼짝도 못하고 더 이상 실행되지 못하는 상황인 '교착 상태'를 해결해야 함

#### 자원 접근 및 할당
- 모든 프로세스 실행을 위해 자원이 필요
- 운영체제는 프로세스들이 사용할 자원을 접근하고 조작함으로써 프로세스에 필요한 자원을 할당해줌

- CPU
  - 일반적으로 메모리에 여러 프로세스가 적재됨
  - CPU는 한번에 하나의 프로세스만 실행 가능 -> 다른 프로세스는 기다려야 함
  => 운영체제는 프로세스들에 공정하게 CPU를 할당하기 위해 어떤 프로세스부터 CPU를 이용하게 할지, 얼마나 오래 사용하게 할지 결정해야 함
  => 이를 CPU 스케쥴링이라고 함

- 메모리
  - 메모리에 적재된 프로세스들은 크기도 적재되는 주소도 다름
  - 같은 프로세스라도 실행될 때마다 적재되는 주소가 달라질 수 있음
  - 새로운 프로세스가 적재될 때마다 어느 주소에 적재할지를 결정해야 함
  - 메모리가 부족할 수도 있고 공간이 있어도 적재하지 못할 수도 있음

- 입출력장치
  - 인터럽트 서비스 루틴은 운영체제가 제공하는 기능으로 커널 영역에 존재
  - 입출력 장치가 CPU에 하드웨어 인터럽트 요청 신호를 보내면 CPU는 하던 일을 백업하고 커널 영역의 인터럽트 서비스 루틴을 실행

#### 파일 시스템 관리
- 파일을 열고 생성하고 삭제할 수 있음
- 파일을 묶어 디렉터리(폴더)로 관리함
- 파일 시스템도 운영체제가 지원하는 핵심 서비스

## 9-3. 추가
### 1) 가상 머신
- 소프트웨어적으로 만들어낸 가상 컴퓨터
- 새로운 운영체제와 응용 프로그램을 설치하고 실행할 수 있음
- 이 경우 가상 머신도 응용 프로그램이라 사용자 모드로 작동
- 가상화를 지원하는 CPU는 커널 모드와 사용자 모드 외에도 가상 머신을 위한 모드인 하이퍼바이저 모드를 둠
- 가상 머신 상에 작동하는 응용 프로그램들은 하이퍼바이저 모드로써 가상 머신에 설치된 운영체제로부터 운영체제 서비스를 받을 수 있음
  ![!\[alt text\](image.png)](<가상 머신과 하이퍼바이저 모드.png>)

### 2) 시스템 호출의 종류
![!\[alt text\](image.png)](<시스템 호출의 종류.png>)

## Q&A
### Q1. 운영체제와 커널에 대해 설명하고 커널에 해당되지 않는 운영체제는 무엇인지 설명하세요.
A1. 운영체제는 실행할 프로그램에 필요한 자원을 할당하고 프로그램이 올바르게 실행되도록 돕는 프로그램입니다. 커널은 자원에 접근하고 조작하는 기능인 핵심 서비스를 담당하는 부분입니다. 운영체제가 설치된 모든 기기에 존재하며 사용자 인터페이스에 해당하는 부분은 커널에 해당되지 않습니다.

### Q2. 이중 모드가 무엇인가요?
A2. 모든 응용 프로그램은 운영체제를 거쳐서만 CPU에 접근할 수 있습니다. 이를 구현하기 위해서 CPU가 명령어를 실행할 때 사용자 모드와 커널 모드로 나누어 실행하게 됩니다. 사용자 모드로 실행되는 일반적인 응용 프로그램은 자원에 접근이 불가능하며 커널 모드로 실행되면 운영 체제 서비스를 제공 받을 수 있습니다.

### Q3. 시스템 호출이 무엇인가요?
A3. 사용자 모드로 실행되는 프로그램이 자원에 접근하는 운영체제 서비스를 제공 받기 위해 커널 모드로 전환하는 방법이며 특정 명령어에 의해 발생하는 소프트웨어적인 인터럽트입니다.

이는 다음과 같은 순서로 진행됩니다. 시스템 호출을 발생시켜 커널 모드로 전환하며 운영체제 내의 코드를 실행합니다. 동작이 모두 완료되면 다시 사용자 모드로 복귀하여 기존 실행되던 사용자 모드의 응용 프로그램으로 복귀하여 실행합니다.